language: go

sudo: required

matrix:
  allow_failures:
  - go: 1.x
  - go: master
- go: 1.x
- go: master
- go: 1.12.x
  env: BUILD=true

before_install:
# rename package name for imports
- mv $HOME/gopath/src/github.com/Vehsamrak $HOME/gopath/src/github.com/vehsamrak

# gox simplifies building for multiple architectures
- go get github.com/mitchellh/gox

script:
# download dependencies
- go get -t -v ./...

# codestyle checks
- diff -u <(echo -n) <(gofmt -d .)
- go vet $(go list ./... | grep -v /vendor/)

# run unit tests with coverage
- bash <(curl -s https://raw.githubusercontent.com/vehsamrak/go-multi-package-coverage/1.1.0/test.sh)

# build binaries
- if [ "${BUILD}" = "true" ]; then gox -os="linux darwin windows" -arch="amd64" -output="logshare.." -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi
- ls

after_success:
# publish coverage report
- bash <(curl -s https://codecov.io/bash)
